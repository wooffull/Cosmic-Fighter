!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.cf=t()}}(function(){return function t(e,i,n){function s(o,r){if(!i[o]){if(!e[o]){var c="function"==typeof require&&require;if(!r&&c)return c(o,!0);if(a)return a(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var d=i[o]={exports:{}};e[o][0].call(d.exports,function(t){var i=e[o][1][t];return s(i?i:t)},d,d.exports,t,e,i,n)}return i[o].exports}for(var a="function"==typeof require&&require,o=0;o<n.length;o++)s(n[o]);return s}({1:[function(t,e,i){"use strict";var n=t("../util"),s=n.Assets,a=t("./Player"),o=wfl.core.entities.GameObject,r=wfl.core.entities.LivingObject,c=wfl.geom,l=function(){r.call(this),this.defaultGraphic=s.get(s.CLIENT);var t=this.defaultGraphic.width,e=this.defaultGraphic.height,i=[new c.Vec2(.5*-t,.5*-e),new c.Vec2(.5*t,0),new c.Vec2(.5*-t,.5*e)],n=this.createFrame(this.defaultGraphic,1,!1);n.vertices=i,this.defaultState=this.createState(),this.defaultState.addFrame(n),this.addState(o.STATE.DEFAULT,this.defaultState),this.rotate(.5*-Math.PI),this.desiredPosition=new c.Vec2};Object.defineProperties(l,{ARRIVAL_SLOWING_RADIUS:{value:200},MIN_ARRIVAL_RADIUS:{value:8},MINIMAP_FILL_STYLE:{value:"#06c833"}}),l.prototype=Object.freeze(Object.create(r.prototype,{update:{value:function(t){if(this.arrivalSteer(),r.prototype.update.call(this,t),this.velocity.getMagnitudeSquared()>1e-5){var e=this.velocity.getAngle()-this.forward.getAngle();this.rotate(e)}}},arrivalSteer:{value:function(){var t=c.Vec2.subtract(this.desiredPosition,this.position),e=t.getMagnitudeSquared(),i=l.ARRIVAL_SLOWING_RADIUS;e>l.MIN_ARRIVAL_RADIUS?(t.setMagnitude(a.BOOST_ACCELERATION*this.mass),i*i>e&&t.multiply(.925*.925*e/(i*i)),this.addForce(t)):this.velocity.multiply(.925)}},drawOnMinimap:{value:function(t){var e=this.getWidth(),i=this.getHeight(),n=Math.round(.5*-e),s=Math.round(.5*-i),a=Math.round(e),o=Math.round(i);t.save(),t.fillStyle=l.MINIMAP_FILL_STYLE,t.fillRect(n,s,a,o),t.restore()}}})),Object.freeze(l),e.exports=l},{"../util":14,"./Player":3}],2:[function(t,e,i){"use strict";var n=t("../util"),s=n.Assets,a=wfl.core.entities.GameObject,o=wfl.core.entities.PhysicsObject,r=function(){o.call(this),this.id=r.id,this.defaultGraphic=s.get(s.BLOCK_FULL),this.defaultState=this.createState(),this.defaultState.addFrame(this.createFrame(this.defaultGraphic)),this.addState(a.STATE.DEFAULT,this.defaultState),this.solid=!0,this.fixed=!0,this.rotate(.5*-Math.PI)};Object.defineProperties(r,{name:{value:"FullBlock"},id:{value:0}}),r.prototype=Object.freeze(Object.create(o.prototype,{drawOnMinimap:{value:function(t){var e=this.getWidth(),i=this.getHeight(),n=Math.round(.5*-e),s=Math.round(.5*-i),a=Math.round(e),o=Math.round(i);t.save(),t.rotate(this.getRotation()),t.beginPath(),t.rect(n,s,a,o),t.fill(),t.stroke(),t.restore()}}})),Object.freeze(r),e.exports=r},{"../util":14}],3:[function(t,e,i){"use strict";var n=t("../util"),s=n.Assets,a=t("../network"),o=wfl.core.entities.GameObject,r=wfl.core.entities.LivingObject,c=wfl.geom,l=function(){r.call(this),this.solid=!0,this.defaultGraphic=s.get(s.PLAYER);var t=this.defaultGraphic.width,e=this.defaultGraphic.height,i=[new c.Vec2(.5*-t,.5*-e),new c.Vec2(.5*t,0),new c.Vec2(.5*-t,.5*e)],n=this.createFrame(this.defaultGraphic,1,!1);n.vertices=i,this.defaultState=this.createState(),this.defaultState.addFrame(n),this.addState(o.STATE.DEFAULT,this.defaultState),this.lastSentPosition=new c.Vec2(-(1/0),-(1/0)),this.rotate(.5*-Math.PI)};Object.defineProperties(l,{TURN_SPEED:{value:.05},BRAKE_RATE:{value:.95},BOOST_ACCELERATION:{value:2e-4},POSITION_UPDATE_DISTANCE:{value:.5},MINIMAP_FILL_STYLE:{value:"#86c8d3"}}),l.prototype=Object.freeze(Object.create(r.prototype,{update:{value:function(t){if(r.prototype.update.call(this,t),a.connected){var e=c.Vec2.subtract(this.position,this.lastSentPosition),i=e.getMagnitudeSquared(),n=l.POSITION_UPDATE_DISTANCE;if(i>=n*n){var s=this.velocity.clone();s.add(this.acceleration.clone().multiply(3));var o=this.position.clone();o.add(s.multiply(3)),a.socket.emit("updateOther",{x:o.x,y:o.y,rotation:this.getRotation()}),this.lastSentPosition=this.position.clone()}}}},drawOnMinimap:{value:function(t){var e=this.getWidth(),i=this.getHeight(),n=Math.round(.5*-e),s=Math.round(.5*-i),a=Math.round(e),o=Math.round(i);t.save(),t.fillStyle=l.MINIMAP_FILL_STYLE,t.fillRect(n,s,a,o),t.restore()}}})),Object.freeze(l),e.exports=l},{"../network":8,"../util":14}],4:[function(t,e,i){"use strict";var n=t("./FullBlock.js"),s=t("./Player.js"),a=t("./ClientPlayer.js");e.exports={FullBlock:n,Player:s,ClientPlayer:a}},{"./ClientPlayer.js":1,"./FullBlock.js":2,"./Player.js":3}],5:[function(t,e,i){"use strict";var n=t("./util"),s=(n.Assets,t("./network")),a=t("./scenes"),o=document.querySelector("#game-canvas"),r=wfl.create(o),c=function(){$(s).on(s.event.CONNECT,l),s.init()},l=function(){var t=new a.GameScene(o);t.keyboard=r.keyboard,r.addScene(t)};new n.Preloader(c.bind(this))},{"./network":8,"./scenes":11,"./util":14}],6:[function(t,e,i){"use strict";var n=t("../entities"),s=function(t,e){this.id=t,this.data=e,this.gameObject=new n.ClientPlayer};Object.freeze(s),e.exports=s},{"../entities":4}],7:[function(t,e,i){"use strict";var n=t("../entities"),s=function(t,e){this.id=t,this.data=e,this.gameObject=new n.Player};Object.freeze(s),e.exports=s},{"../entities":4}],8:[function(t,e,i){"use strict";var n=t("./Client.js"),s=t("./LocalClient.js"),a={socket:void 0,localClient:{},clients:{},connected:!1,event:{CONNECT:"connect",REMOVE_CLIENT:"removeClient",ADD_CLIENT:"addClient"},init:function(){this.socket=io.connect(),this.socket.on("confirm",this.onConfirmClient.bind(this)),this.socket.on("addOther",this.onAddOtherClient.bind(this)),this.socket.on("removeOther",this.onRemoveOtherClient.bind(this)),this.socket.on("loadPrevious",this.onLoadPreviousClients.bind(this)),this.socket.on("updateOther",this.onUpdateOtherClient.bind(this)),this.socket.emit("init",{user:"user"})},onConfirmClient:function(t){var e=t.id;this.localClient=new s(e,t),this.clients[e]=this.localClient,this.localClient.gameObject.position.x=t.x,this.localClient.gameObject.position.y=t.y,this.connected=!0,$(this).trigger(this.event.CONNECT)},onAddOtherClient:function(t){var e=t.id,i=new n(e,t);i.gameObject.position.x=t.x,i.gameObject.position.y=t.y,i.gameObject.desiredPosition.x=t.x,i.gameObject.desiredPosition.y=t.y,i.gameObject.setRotation(t.rotation),this.clients[t.id]=i,$(this).trigger(this.event.ADD_CLIENT,this.clients[t.id])},onRemoveOtherClient:function(t){$(this).trigger(this.event.REMOVE_CLIENT,this.clients[t.id]),this.clients[t.id]=void 0,delete this.clients[t.id]},onLoadPreviousClients:function(t){for(var e=Object.keys(t),i=0;i<e.length;i++){var n=parseInt(e[i]),s=t[n];this.onAddOtherClient(s)}},onUpdateOtherClient:function(t){var e=t.id,i=this.clients[e];i.data.x=t.x,i.data.y=t.y,i.gameObject.desiredPosition.x=t.x,i.gameObject.desiredPosition.y=t.y,i.data.rotation=t.rotation},onFocusUpdate:function(){for(var t=Object.keys(this.clients),e=0;e<t.length;e++){var i=parseInt(t[e]),n=this.clients[i];if(n!==this.localClient){var s=n.gameObject;s.position.x=n.data.x,s.position.y=n.data.y,s.setRotation(n.data.rotation),s.velocity.multiply(0),s.acceleration.multiply(0)}}}};e.exports=a},{"./Client.js":6,"./LocalClient.js":7}],9:[function(t,e,i){"use strict";var n=t("../util"),s=n.Assets,a=t("../network"),o=t("../entities"),r=o.FullBlock,c=o.Player,l=t("./NetworkScene"),d=wfl.display.backgrounds,h=wfl.geom,u=function(t){l.call(this,t);for(var e=10,i=128,n=-(.5*e-1)*i,o=0;9>o;o++){var c=new r;c.position.x=i*o+n,c.position.y=n,this.addGameObject(c)}for(var o=0;9>o;o++){var c=new r;c.position.x=i*o+n,c.position.y=-n,this.addGameObject(c)}for(var o=1;8>o;o++){var c=new r;c.position.x=n,c.position.y=i*o+n,this.addGameObject(c)}for(var o=1;8>o;o++){var c=new r;c.position.x=-n,c.position.y=i*o+n,this.addGameObject(c)}this.bg=new d.ParallaxBackground(s.get(s.BG_TILE)),this.player=a.localClient.gameObject,this.addGameObject(this.player)};Object.defineProperties(u,{FRICTION:{value:.925},MINIMAP:{value:Object.freeze({WIDTH:150,HEIGHT:100,SCALE:.1,FILL_STYLE:"#192427"})}}),u.prototype=Object.freeze(Object.create(l.prototype,{update:{value:function(t){for(var e=0;e<this.gameObjects.length;e++){var i=this.gameObjects[e];i.acceleration.multiply(u.FRICTION),i.velocity.multiply(u.FRICTION)}l.prototype.update.call(this,t),this.handleInput()}},handleInput:{value:function(){var t=this.player,e=this.keyboard,i=e.isPressed(e.LEFT),n=e.isPressed(e.RIGHT),s=e.isPressed(e.UP),a=e.isPressed(e.DOWN);if(i||n){var o=0;i&&(o-=c.TURN_SPEED),n&&(o+=c.TURN_SPEED),t.rotate(o)}if(s){var r=h.Vec2.fromAngle(t.getRotation());r.multiply(c.BOOST_ACCELERATION*t.mass),t.addForce(r)}a&&t.velocity.multiply(c.BRAKE_RATE)}}})),e.exports=u},{"../entities":4,"../network":8,"../util":14,"./NetworkScene":10}],10:[function(t,e,i){"use strict";var n=t("../network"),s=wfl.display.Scene,a=function(t){s.call(this,t),$(n).on(n.event.ADD_CLIENT,this.onAddClient.bind(this)),$(n).on(n.event.REMOVE_CLIENT,this.onRemoveClient.bind(this));for(var e=Object.keys(n.clients),i=0;i<e.length;i++){var a=parseInt(e[i]),o=n.clients[a];o!==n.localClient&&this.addGameObject(o.gameObject)}};a.prototype=Object.freeze(Object.create(s.prototype,{onAddClient:{value:function(t,e){e&&this.addGameObject(e.gameObject)}},onRemoveClient:{value:function(t,e){e&&this.removeGameObject(e.gameObject)}}})),e.exports=a},{"../network":8}],11:[function(t,e,i){"use strict";var n=t("./NetworkScene.js"),s=t("./GameScene.js");e.exports={NetworkScene:n,GameScene:s}},{"./GameScene.js":9,"./NetworkScene.js":10}],12:[function(t,e,i){"use strict";e.exports={BG_TILE:"./media/BG-tile1.png",BLOCK_FULL:"./media/BlockFull.png",PLAYER:"./media/Ship.png",CLIENT:"./media/OtherShip.png",get:function(t){}}},{}],13:[function(t,e,i){"use strict";var n=t("./Assets.js"),s=function(t){this.queue=new createjs.LoadQueue(!1),n.get=this.queue.getResult.bind(this.queue),t&&this.queue.on("complete",t);var e=[];for(var i in n){var s={id:i,src:n[i]};e.push(s)}this.queue.loadManifest(e)};e.exports=s},{"./Assets.js":12}],14:[function(t,e,i){"use strict";var n=t("./Assets.js"),s=t("./Preloader.js");e.exports={Assets:n,Preloader:s}},{"./Assets.js":12,"./Preloader.js":13}]},{},[5])(5)});
